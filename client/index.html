<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Twatts</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
</head>

<body>
    <section class="section">
        <div class="container">
            <h1 class="title">
                Welcome to Twatts
            </h1>
            <p class="subtitle">
                My first Twitter Aggregator
                <strong>Andrew</strong>!
            </p>
            <div class="field">
                <label class="label">Status</label>
                <div class="control">
                    <input class="input" type="text" id="statusInput" placeholder="Text input">
                </div>
            </div>
            <div class="field is-grouped">
                <div class="control">
                    <button id="submit" class="button is-link">Submit</button>
                </div>
            </div>
            <br/>
            <div class="field">
                <label class="label">Keyword</label>
                <div class="control">
                    <input class="input" type="text" id="keyword" placeholder="Text input">
                </div>
            </div>
            <div class="field is-grouped">
                <div class="control">
                    <button id="submitKeyword" class="button is-link">Search Me</button>
                </div>
            </div>
            <div class="search"></div>
            <br/>
        </div>
    </section>
</body>

<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>

<script>
    $.ajax({
        url: "http://localhost:3000/",
        dataType: 'json',
        type: 'get',
        success: (results) => {
            console.log(results)
            results.map((result) => {
                $(".section").append(
                    `
                <div class="box">
                <article class="media">
                    <div class="media-left">
      <figure class="image is-48x48">
        <img src="${result.user.profile_image_url}" alt="Image">
      </figure>
    </div>
                    <div class="media-content">
                        <div class="content">
                            <p>
                                <strong>${result.user.name}</strong> <small>@${result.user.screen_name}</small> <small>31m</small>
                                <br>
                                ${result.text}
                            </p>
                        </div>
                    </div>
                </article>
            </div>
            `
                )
            })
        },
        error: function (err) {
            console.log(err);
        }
    });

    $("#submit").click(() => {
        $.ajax({
            url: "http://localhost:3000/post",
            type: "post",
            data: {
                stat: $("#statusInput").val()
            },
            success: (result) => {
                $("#statusInput").val('')
                $(".section").append(
                    `
                <div class="box">
                <article class="media">
                    <div class="media-content">
                        <div class="content">
                            <p>
                                ${result.text}
                            </p>
                        </div>
                    </div>
                </article>
            </div>
            `
                )
            },
            error: (err) => {
                console.log(err)
            }
        })
    })

    $("#submitKeyword").click(() => {
        $.ajax({
            url: "http://localhost:3000/search",
            type: "post",
            data: {
                keyword: $("#keyword").val()
            },
            success: (result) => {
                $("#keyword").val('')
                $(".search").append(
                    `
                <div class="box">
                <article class="media">
                    <div class="media-content">
                        <div class="content">
                            <p>
                                ${result.text}
                            </p>
                        </div>
                    </div>
                </article>
            </div>
            `
                )
            },
            error: (err) => {
                console.log(err)
            }
        })
    })
</script>


</html>